{% extends "base.html" %}
{% block head %}
<script src="https://unpkg.com/html5-qrcode"></script>
{% endblock %}
{% block body %}
<div class="container">
  <h2>Escanear QR</h2>
  <div id="auth">
    <input id="pwd" type="password" placeholder="Contraseña">
    <button id="goScan">Ingresar</button>
    <div id="authErr" class="alert"></div>
  </div>
  <div id="reader" style="width:100%;display:none;"></div>
  <div id="res" class="alert"></div>
</div>
<script>
const pwdFld = document.getElementById("pwd"),
      authErr = document.getElementById("authErr"),
      authDiv = document.getElementById("auth"),
      reader  = document.getElementById("reader"),
      resDiv  = document.getElementById("res");

document.getElementById("goScan").onclick = () => {
  if (pwdFld.value!=="Nivelbasico2025") {
    authErr.textContent="Contraseña inválida";
    return;
  }
  authDiv.style.display="none";
  reader.style.display="block";
  const html5QrcodeScanner = new Html5Qrcode("reader");
  html5QrcodeScanner.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    qr => {
      html5QrcodeScanner.stop();
      fetch("/escanear", {
        method:"POST", headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ curp:qr, password:pwdFld.value })
      })
      .then(r=>r.json()).then(j=> resDiv.textContent=j.mensaje);
    }
  );
};
</script>
{% endblock %}
